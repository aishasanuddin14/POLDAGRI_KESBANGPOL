<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DATA SEBARAN ORMAS TAHUN 2025</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
  body{background:#f6f7fb}
  #map{height:520px;border-radius:12px}
  .filter-badge.btn{border-radius:12px;padding:14px 10px;font-weight:600}
  .filter-badge.active{outline:2px solid #111;box-shadow:0 0 0 2px rgba(0,0,0,.08) inset}
  /* Marker angka: jangan pecah baris */
  .badge-pin{
    background:#2563eb;color:#fff;border-radius:999px;
    padding:2px 8px;border:2px solid #1e40af;
    box-shadow:0 2px 6px rgba(0,0,0,.2);
    font-weight:700;font-size:.8rem;line-height:1;
    display:inline-flex;align-items:center;justify-content:center;
    min-width:30px; white-space:nowrap;
  }
  .d-none{display:none!important}
  /* tampilkan semua kolom, biar wrap teks panjang */
  table.dataTable td, table.dataTable th { white-space: normal; }
  /* Matikan smooth scroll yang suka bikin “nyeloncat” */
  html { scroll-behavior: auto !important; }
  /* Jangan auto-focus anchor/pagination DataTables */
  .dataTables_wrapper a:focus { outline: none !important; box-shadow: none !important; }
</style>
</head>
<body>
<div class="container py-4">
  <header class="mb-3">
    <h1 class="fw-bold text-center">Laporan Keberadaan Ormas, Paguyuban, Lembaga — Halmahera Tengah</h1>
    <p class="text-muted mb-0 text-center">Klik badge atau pilih Desa. Peta dan tabel tampil bersamaan.</p>
  </header>

  <!-- BAR ATAS: Badges kiri, Dropdown Desa kanan -->
  <section class="mb-3">
    <div class="row g-2 align-items-end">
      <div class="col-12 col-lg-8">
        <div class="row g-2 text-center">
          <div class="col-6 col-md-3">
            <button type="button" class="btn btn-primary w-100 filter-badge" data-mode="all">Semua<br><span id="bAll" class="fs-5">0</span></button>
          </div>
          <div class="col-6 col-md-3">
            <button type="button" class="btn btn-warning text-dark w-100 filter-badge" data-mode="nasional">Nasional<br><span id="bNas" class="fs-5">0</span></button>
          </div>
          <div class="col-6 col-md-3">
            <button type="button" class="btn btn-secondary w-100 filter-badge" data-mode="lokal">Lokal/Daerah<br><span id="bLok" class="fs-5">0</span></button>
          </div>
          <div class="col-6 col-md-3">
            <button type="button" class="btn btn-dark w-100" disabled>Total<br><span id="bTotal" class="fs-5">0</span></button>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <label for="desaSelect" class="form-label mb-1">Filter Desa/Lokasi</label>
        <div class="d-flex gap-2">
          <select id="desaSelect" class="form-select">
            <option value="">— Semua Desa —</option>
          </select>
          <button id="reset" class="btn btn-outline-secondary">Reset</button>
        </div>
      </div>
    </div>
  </section>

  <!-- MAP -->
  <section class="mb-4 d-none" id="mapSection">
    <div class="card shadow-sm p-3">
      <h6 class="mb-3">Sebaran pada Peta (angka = jumlah ormas per titik)</h6>
      <div id="map"></div>
      <div id="tip" class="alert alert-warning mt-2 d-none">
        Tidak ada marker. Cek kolom <strong>Latitude</strong> dan <strong>Longitude</strong>.
      </div>
    </div>
  </section>

  <!-- TABLE -->
  <section class="mb-4 d-none" id="tableSection">
    <div class="card shadow-sm p-3">
      <div class="table-responsive">
        <table id="ormasTable" class="table table-striped table-bordered w-100">
          <thead class="table-light"><tr id="tblHead"></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <footer class="py-3 text-center"><small>© 2025 Kesbangpol Halmahera Tengah | Data tertanam.</small></footer>
</div>

<!-- libs -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ====== SCROLL LOCK ====== */
function lockScrollPos(){ return {x:window.scrollX||0, y:window.scrollY||0}; }
function restoreScrollPos(p){
  if(!p) return;
  window.scrollTo(p.x,p.y);
  setTimeout(()=>window.scrollTo(p.x,p.y), 50);
  setTimeout(()=>window.scrollTo(p.x,p.y), 120);
}
/* cegah anchor "#" bikin halaman loncat */
document.addEventListener('click', function(e){
  const a = e.target.closest('a[href="#"]');
  if(a && a.closest('.dataTables_wrapper')) e.preventDefault();
}, true);
</script>

<script>
/* ========= DATA TERTANAM (CSV) ========= */
/* Ganti RAW_CSV ini kalau perlu. Gunakan delimiter ; sesuai file kamu. */
const RAW_CSV = `Nama Ormas;Jenis;Nama Ketua;Alamat;Latitude;Longitude;Lingkup;Status SKT;Status SKKO;Nomor HP;Kegiatan Ter-Deteksi (2024-2025);Akun Media Sosial/Group
JPKP Halteng;Sosial;Sri Wahyuni;Desa Fidi Jaya;0.3504959340788942;12.785.643.040.161.500;Lokal;Belum Ada;Belum Lapor;+62 823-2445-9850;Tidak ada jejak;–
Panjat Tebing (FPTI Halteng);Olahraga;Moh. Fitra U. Ali;Desa Nurweda;0.34160299912748765;1.278.476.213.816.390;Nasional;SKT Kemendagri;Belum Lapor;–;"Roadshow FPTI Maret 2025; Partisipasi lomba Panjat tebing Kota Ternate tahun 2025"
KKSS Halteng;Etnis;Hj. Muttiara T. Yasin;Desa Fidi Jaya;0.3504959340788942;12.785.643.040.161.500;Lokal;Belum Ada;Kadaluwarsa;–;"Dilantik (Des 2023); Tidak ada jejak";–
DPD LSM Pelapis Nusantara Halteng;LSM/Advokasi;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;Kadaluwarsa;–;Halteng;"Advokasi banjir IWIP; kolaborasi Wagub Malut; Laporan resmi ke Kejaksaan (Mar 2025)"
Lembaga Investigasi Negara;LSM/Advokasi;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;Kadaluwarsa;–;Halteng;"Bakti sosial Ramadhan 2025; Koordinasi dengan Kejaksaan (Apr 2025)"
Taekwondo Indonesia Mitra Club Halteng;Olahraga;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;"Kompetisi 2025; Kejuaraan provinsi (Mei 2025)";–
Pemuda Falcino;Kepemudaan;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;Kadaluwarsa;–;Weda;Upacara HUT 2025
CIPAL;LSM/Advokasi;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;Kadaluwarsa;–;Halteng;Mitigasi dampak tambang
Ikatan Keluarga Minang Halteng;Etnis;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;Kadaluwarsa;–;Halteng;"Kopdar diaspora; advokasi upah"
Serikat Pekerja Lelilef Waibulan;Serikat Buruh;Bamusbay Man;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;Lelilef Waibulan;"Ngopi Darat Polres April 2025; advokasi upah"
LSM KABATA;Sosial/Budaya;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;Halteng;Demo 2025 tuntut pencopotan
Kelompok Tani Hutan Kab. Halmahera Tengah;Pertanian;Yordan Doter (Gilepes);Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;Kobe);Ekstensi mangrove 2025
MPC Pemuda Pancasila Halteng;Kepemudaan;Juardi Salasa;Desa Nurweda;0.34160299912748765;1.278.476.213.816.390;Nasional;SKT Kemendagri;Kadaluwarsa;0822-1540-1663;"Muscab IV (Okt 2020); Pelantikan 2025; advokasi desa";–
DPD Garda NasDem Halteng;Politik;Munadi Kilkoda;Desa Nurweda;0.34160299912748765;1.278.476.213.816.390;Nasional;SKT Kemendagri;Kadaluwarsa;–;"PSP Berderma 2025; jalan sehat HUT";–
DPD KNPI Halteng VERSI I;Kepemudaan;Moh. Guntur Abd. Rahman;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;SKT Kemendagri;Kadaluwarsa;0821-9665-7571;"Pelantikan pengurus dua versi (2023); Pendaftaran calon ketua 2025; FGD pemilu";–
Ikatan Keluarga Sanana Mangoli Taliabu (IKSMT);Etnis;Junaidi Gailea;Desa Fidi Jaya;0.3504959340788942;12.785.643.040.161.500;Lokal;Belum Ada;;–;"Jalan sehat 2025; silaturahmi";–
Kerukunan Keluarga Jawa Weda;Etnis/Budaya;Tidak terverif;Desa Fidi Jaya;0.3504959340788942;12.785.643.040.161.500;Lokal;Belum Ada;;–;"Arisan budaya 2025; HUT KKJ; Pentas seni budaya tahunan";–
KBM Malang Halteng;Sosial Masyarakat;Ahkamil Hamid;Weda;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;;–;"Diskusi pernikahan 2025; migrasi tambang,https://www.facebook.com/groups/569467587379492/";–
GP Ansor Halteng;Kepemudaan;Moch. Rizky Hasyim;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Doa bersama lintas agama 2025; dialog polisi; Khitanan massal (Jul 2021)";https://www.facebook.com/gpansorhalteng/
Kampung KB Lelilef Sawa;Kesehatan Keluarga;Tidak terverif;Desa Lelilef Sawai;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Belum Lapor;–;Program BKKBN 2023-2025;–
OPLS Lelilef Sawai;Komunitas;Melky Sedek Arbaben;Desa Lelilef Sawai;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Belum Lapor;–;"Carnival Youth Juli 2024; renovasi lapangan";https://www.facebook.com/p/Organisasi-Pemuda-Desa-Lelilef-Sawai-OPLS-100067577652017/
Kerukunan Loloda Bersatu (KLB) Halmahera Tengah;Etnis;Alfaren Rivaaldo Leki;Desa Lelilef Sawai;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Belum Lapor;;Penggalangan Dana;
AMPG Halteng;Kepemudaan;Kaderun Karim;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Bakti sosial 2025; penggalangan opini";–
Kosgoro Halteng;Sosial Masyarakat;Arief Djalaludin;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Pelantikan PDK 2025; HUT Kosgoro";–
DPD KNPI Halteng VERSI II;Kepemudaan;Endasari Effendi;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Mandat Plt ketua 2025; konflik versi";–
Muslimat NU Halteng;Keagamaan;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Salawat Zikir Juli 2021; pelantikan 2024";https://www.facebook.com/people/Muslimat-NU-HT/100077741720388/
Kelompok Budidaya Air Tawar Weda Tengah;Ekonomi;Abdul Yusup Teapon;Desa Lelilef Waibulan;0.4543390177251834;12.791.091.012.948.300;Lokal;Belum Ada;Belum Lapor;–;"Panen ikan 2024; pelatihan DKP";–
GMKI Halteng;Keagamaan/Mahasiswa;Tiwing Peo;Weda;0.34160299912748765;1.278.476.213.816.390;Nasional;SKT Kemendagri;Kadaluwarsa;–;"FGD KPU Feb 2025; advokasi desa";–
Ikatan Keluarga Tidore Kepulauan (IKTK);Etnis;Zakir Toduho;Desa Lelilef Waibulan;0.4543390177251834;12.791.091.012.948.300;Lokal;Belum Ada;Berakhir 2025;–;"Arisan Muharram Juli 2025; rindu Gunung Marijang";https://www.facebook.com/groups/754036187963583/
Ikatan Keluarga Gorontalo;Etnis;Tidak terverif;Desa Lelilef Waibulan;0.4543390177251834;12.791.091.012.948.300;Lokal;Belum Ada;Sudah Lapor;–;"Diskusi migrasi Mei 2024; rindu Hulontalo";–
BKPRMI Halteng;Keagamaan;Tasrif U. Peley;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Larangan ibadah IWIP 2020; dialog 2025";–
Forum Warga Lingkar Tambang Desa Lelilef;Forum Masyarakat;Tidak terverif;Desa Lelilef Waibulan;0.4543390177251834;12.791.091.012.948.300;Lokal;Belum Ada;Belum Lapor;–;"Patroli & dialog 2025; respons banjir";–
Kerukunan Keluarga Makayoa Halteng;Paguyuban;Jamrud Hamid;Desa Wedana;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;–;"Musyawarah II 2025; silaturahmi";–
PNU WERE;Paguyuban;Saifullah Hi. Yamin;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;;–;"Lomba Cogoipa 2025; Maulid Nabi";–
BAKOR;Sosial Masyarakat;Hamlan Kamaludin;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;;–;"Mengawal Usulan Pemekaran beberapa DOB. Termasuk DOB Patani dan Pulau Gebe; Tidak ada jejak (potensi pemerintahan)";–
Forum Komunikasi Masyarakat Gebe;Komunitas;Tidak terverif;Pulau Gebe;-0.04916289321837482;1.294.055.360.089.350;Lokal;Belum Ada;;–;"Rapat konsultasi publik 2025; UMKM diskusi; Demo di Jakarta tuntut penindakan tambang ilegal (Jul 2025)";https://www.facebook.com/groups/253201676127085/
Badan Koordinasi Pemekaran Patani Gebe;Politik/Advokasi;Hamlan Kamaludin;Pulau Gebe;-0.04916289321837482;1.294.055.360.089.350;Lokal;Belum Ada;;–;"FGD DOB 2025; serah dokumen Kemendagri; FGD di Jakarta (Jan 2025)";–
HIPMAHALTENG;Mahasiswa;Tidak terverif;Ternate;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;–;"Sosialisasi pemilu; sadar sampah 2025; Bimbingan belajar & diskusi isu daerah (2024–2025)";https://www.instagram.com/official_hipmahalteng/
Ikatan Mahasiswa Tambang Halteng;Mahasiswa;Tidak terverif;Ternate;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;–;Demo tolak tambang 2025;–
Koalisi Perempuan Indonesia Halteng;Sosial/Perempuan;Tidak terverif;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;–;"Pelatihan hak perempuan 2025; Workshop biogas (Jul 2025)";https://www.facebook.com/groups/117204568317155/
BAMAGNAS Halteng;Keagamaan;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Nasional;SKT Kemendagri;Kadaluwarsa;–;"Rakernas Semarang 2023; toleransi; Doa bersama antar gereja (Nov 2024)";–
GAKARYA;Sosial;Zul Rijal;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;"Pelantikan 2024; bonus produksi";https://www.tiktok.com/@gakaryaiwip856
ASPN;LSM/Advokasi;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Dialog polisi 2025;–
P2M TOGASSA;Pendidikan/Sosial;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Advokasi masyarakat Gebe;–
Ikatan Keluarga Sultra Halteng;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Silaturahmi budaya 2025;–
Muhammadiyah PD Halteng;Keagamaan;Dr. Lassamida Kurpunda;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;"Hisab hijriah 2025; PPDB sekolah; Musda II (Jun 2023)";–
Ikatan Keluarga Halbar (IKHB);Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Sosialisasi pemilu 2025;–
Persatuan Keluarga Gane Raya;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Bantuan sosial 2025;–
Ikatan Keluarga Tanimbar;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Edukasi COVID 2025;–
IKA (Ikatan Keluarga Aru);Etnis;Salmon Dumgair;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Persatuan 2025;–
KKST;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Sudah Lapor;–;Tidak ada jejak baru;–
Kawanua Sulut;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Kopdar 2025;–
Ikatan Keluarga Minahasa Utara;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Sosialisasi pemilu;–
Ikatan Keluarga Jambi;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Demo Rempang 2025 spillover;–
Ikatan Keluarga Sumatera;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Nostalgia kopdar;–
Paguyuban Jawa Lestari;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Arisan budaya 2025;–
Paguyuban Fadel PNU PIWAL;Etnis/Kekerabatan;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;"Reuni akbar (Mei 2023); Tidak ada jejak";–
Loloda Bersatu;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Bantuan sosial 2025;–
Togale;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Festival budaya 2025;–
Sula Bersatu;Etnis;Jeldi;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Baksos pantai Lelilef 2025;–
PKM Kao–Malifut;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;KKN mahasiswa 2025;–
ASB;LSM/Advokasi;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Tidak ada jejak;–
Maluku Satu Rasa (M1R);Etnis;Donald Tehupuring;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Bantuan korban banjir 2025;–
AM-Kei;Etnis;John Refra;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;"Pelantikan 2025; pionir anak muda";–
AM-KAI;Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Tidak ada jejak;–
Maluku Satu Gandong (M1G);Etnis;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Tidak ada jejak;–
Generasi Muda Fagogoru Halteng;Kepemudaan;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;HUT Halteng lomba 2025;–
Ikatan Alumni Menwa Halteng;Alumni;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;Baksos COVID 2025;–
JANGKAR;Komunitas;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Sudah Lapor;0821-1533-1416;Tidak ada jejak;–
FKPM Halteng;Mahasiswa;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;"Tidak ada jejak; Diskusi & nobar dampak tambang (Ags 2025)";–
Komunitas SOBATMU;Lingkungan;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Belum Lapor;–;"Sagu Halteng Bersih 2025; Gerakan “Satu Genggam untuk Halteng Bersih” (Ags 2025)";–
Majelis Taklim Nurul Haq;Keagamaan;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;"Taklim rutin 2025; Kajian & ceramah agama rutin";–
Dewan Kebudayaan Halteng;Budaya;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;Festival Fagogoru 2025;–
WADOKAI Halteng;Bela Diri;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Lokal;Belum Ada;Kadaluwarsa;–;Tidak ada jejak;–
Kelompok Peduli Hutan Mangrove;Lingkungan;Mohammad Ridwan Lessy;Weda Tengah;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Belum Lapor;–;"Pelatihan bibit 2024; revitalisasi 2025";–
Pusat Persatuan Buruh PT IWIP;Buruh/Serikat;Bamusbay Man;Weda Tengah;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Belum Lapor;–;Waibulan;"Wisata ilmiah Juli 2025; kritik upah; Aksi buruh menuntut hak-hak pekerja (2023–2025)"
Ikatan Keluarga Maluku Halteng (IKM);Etnis;Arsyad Sanaki;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;–;Weda Tengah;"Kopdar tolak RMS Agustus 2025; silaturahmi rindu Ambon"
Generasi Cekel Kreatif;Seni/Kreatif;Subhan Somola;Desa Wedana;0.34160299912748765;1.278.476.213.816.390;Lokal;Belum Ada;;0813-4280-2319;"Renovasi lapangan cekel 2025; olahraga desa";–
Pemuda Muhammadiyah Halteng;Keagamaan;Supriono Sufrin;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;"Soroti air bersih 2025; advokasi lingkungan";https://www.facebook.com/pemudamuhammadiyahhalteng/
Aisyiyah Muhammadiyah Halteng;Keagamaan;Tidak terverif;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;"Pelantikan 2025; pengasuhan keluarga";–
LSM Lima Fal Gali;Sosial Masyarakat;Rusli Ishak;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;Kadaluwarsa;81340897645;"Mendesak Kejaksaan usut dugaan penyalahgunaan anggaran dinas (2022); Tidak ada jejak (potensi lingkungan)";–
LSM Gate Ri Moi Maluku Utara Bersatu;Sosial Masyarakat;Moh. Rohadi Do. Iskandar;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;Kadaluwarsa;0853-9491-5509;Demo tuntut otonomi 2025;–
LSM Gele-Gele;Sosial Masyarakat;Husen Ismail;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;Kadaluwarsa;0812-7977-6552;"Soroti KPH & ilegal logging 2025; advokasi pulau Gebe; Mendesak pemerintah terkait polemik dua pulau (Sep 2025)";–
Sanggar Kabata;Kesenian/Kreatif;Arman Alting;Desa Were;0.359893784354826;12.786.053.222.873.400;Lokal;Belum Ada;Kadaluwarsa;–;"Lomba motif Cogoipa 2025; tarian Bon Mayu";–
Nahdlatul Ulama Halteng;Keagamaan;Drs. Nurhalis Abubakar;Desa Were;0.359893784354826;12.786.053.222.873.400;Nasional;AHU Kemenkumham;Kadaluwarsa;;"Harlah NU 102 2025; doa lintas agama";–
PPNI Halteng;Profesi;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;"Ultah PPNI 46; baksos 2025";https://www.facebook.com/ppnihalteng/
Ikatan Apoteker Indonesia Halteng;Profesi;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;Hari Apoteker 2025;–
Koperasi TKBM Mon Power;Buruh/Koperasi;Tidak terverif;Weda Tengah;0.47592348496176967;12.794.293.021.679.300;Lokal;Belum Ada;Kadaluwarsa;–;Pelatihan 2024;–
DPC GAPEKSINDO Halteng;Profesi;Tidak terverif;Weda Tengah;0.5180718143746648;12.788.981.391.410.400;Nasional;AHU Kemenkumham;Kadaluwarsa;–;Rakernas 2023;–
LPMG Gebe;LSM/Advokasi;Tidak terverif;Pulau Gebe;-0.04916289321837482;1.294.055.360.089.350;Lokal;;Kadaluwarsa;–;Weda Tengah;"Advokasi pemekaran wilayah; demo tambang; Pelatihan kerajinan tangan (Jun 2024) https://www.facebook.com/groups/253201676127085/"
LSM WAMPEL;LSM/Advokasi;Yusmar Ohorela;Weda;0.34160299912748765;1.278.476.213.816.390;Lokal;;Kadaluwarsa;–;"Weda Tengah Demo tuntut pejabat nasional; inventarisasi ormas siluman";Halteng`;

/* ========= KOL0M ========= */
const COLS = [
  'Nama Ormas','Jenis','Nama Ketua','Alamat','Latitude','Longitude',
  'Lingkup','Status SKT','Status SKKO','Nomor HP',
  'Kegiatan Ter-Deteksi (2024-2025)','Akun Media Sosial/Group'
];

/* ========= STATE & UTIL ========= */
let ALL = [], DT = null, MAP = null, LAYER = null;
const state = { mode:'all', desa:'' };

const qs  = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const norm = v => String(v ?? '').trim();

/* angka multi-titik -> desimal, auto-swap lat/lng */
function toNum(v){
  if(v==null) return NaN;
  let s = String(v).trim().replace(/\u00A0/g,' ');
  if(/^\d{1,3}(?:\.\d{3}){2,}$/.test(s)) { const d = s.replace(/\./g,''); s = d.slice(0,3)+'.'+d.slice(3); }
  s = s.replace(',', '.').replace(/[^0-9.\-]/g,'');
  const n = parseFloat(s);
  return Number.isFinite(n) ? n : NaN;
}

/* parser CSV yang hormati "..." */
function parseCSV(text, delimiter=';'){
  text = text.replace(/^\uFEFF/,'');
  const lines = text.split(/\r?\n/).filter(l=>l.trim().length);
  const out = [];
  const parseLine = (line)=>{
    const cells = []; let cur = '', inQ = false;
    for(let i=0;i<line.length;i++){
      const ch=line[i], nx=line[i+1];
      if(ch === '"'){ if(inQ && nx === '"'){cur+='"'; i++;} else inQ=!inQ; }
      else if(ch===delimiter && !inQ){ cells.push(cur); cur=''; }
      else cur += ch;
    }
    cells.push(cur);
    return cells.map(s=>s.trim());
  };
  const header = parseLine(lines[0]);
  const idx = COLS.map(h => header.findIndex(x => x.toLowerCase()===h.toLowerCase()));
  const miss = COLS.filter((h,i)=>idx[i]===-1);
  if(miss.length){ throw new Error('Header tidak cocok: '+miss.join(', ')); }
  for(let i=1;i<lines.length;i++){
    const raw = parseLine(lines[i]); const obj = {};
    COLS.forEach((h,j)=>obj[h] = raw[idx[j]] ?? '');
    out.push(obj);
  }
  return out;
}

/* ========= BADGES & DROPDOWN ========= */
function updateBadges(){
  qs('#bTotal').textContent = ALL.length;
  qs('#bAll').textContent   = ALL.length;
  qs('#bNas').textContent   = ALL.filter(r=>norm(r['Lingkup']).toLowerCase().includes('nasional')).length;
  qs('#bLok').textContent   = ALL.filter(r=>{
    const s = norm(r['Lingkup']).toLowerCase();
    return s.includes('lokal') || s.includes('daerah');
  }).length;
}
function fillDesaDropdown(){
  const set = new Set();
  ALL.forEach(r=>{
    const a = norm(r['Alamat']);
    if(a) set.add(a);
  });
  const list = Array.from(set).sort((a,b)=>a.localeCompare(b,'id'));
  const sel = qs('#desaSelect');
  sel.innerHTML = '<option value="">— Semua Desa —</option>' + list.map(v=>`<option value="${v.replace(/"/g,'&quot;')}">${v}</option>`).join('');
}

/* ========= FILTERING ========= */
function getSubset(){
  let rows = ALL.slice();
  if(state.mode==='nasional'){
    rows = rows.filter(r=>norm(r['Lingkup']).toLowerCase().includes('nasional'));
  } else if(state.mode==='lokal'){
    rows = rows.filter(r=>{
      const s = norm(r['Lingkup']).toLowerCase();
      return s.includes('lokal')||s.includes('daerah');
    });
  }
  if(state.desa){
    const q = state.desa.toLowerCase();
    rows = rows.filter(r=>norm(r['Alamat']).toLowerCase()===q || norm(r['Alamat']).toLowerCase().includes(q));
  }
  return rows;
}

/* ========= TABEL ========= */
function buildHeader(){
  const head = qs('#tblHead'); head.innerHTML='';
  COLS.forEach(name=>{
    const th=document.createElement('th'); th.textContent=name; head.appendChild(th);
  });
}
function drawTable(rows){
  buildHeader();
  const data = rows.map(r => COLS.map(k => norm(r[k]) || '-'));
  const cols = COLS.map(title=>({title}));
  const $ = window.jQuery;
  if(!DT){
    DT = $('#ormasTable').DataTable({
      data, columns: cols,
      pageLength: 25,
      responsive: false,
      autoWidth: true,
      scrollX: true,
      order: [[0,'asc']],
      deferRender: true,
      language:{
        search:"Cari:",lengthMenu:"Tampilkan _MENU_ entri",zeroRecords:"Tidak ada data",
        info:"Menampilkan _START_–_END_ dari _TOTAL_",infoEmpty:"Tidak ada data",infoFiltered:"(disaring dari _MAX_ total data)"
      }
    });
    // Kunci posisi scroll agar tidak loncat pada semua event redraw
    let pos = {x:0,y:0};
    const cap = ()=>{ pos = lockScrollPos(); };
    const res = ()=>{ restoreScrollPos(pos); };
    $('#ormasTable')
      .on('preDraw.dt page.dt order.dt search.dt length.dt', cap)
      .on('draw.dt', res);
  }else{
    const pos = lockScrollPos();
    DT.clear().rows.add(data).draw(false);
    DT.columns.adjust();
    restoreScrollPos(pos);
  }
}

/* ========= PETA ========= */
function ensureMap(){
  if(MAP) return;
  MAP = L.map('map').setView([0.33,127.87], 9);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:18, attribution:'&copy; OpenStreetMap contributors'
  }).addTo(MAP);
  LAYER = L.layerGroup().addTo(MAP);
}
function groupByLocation(rows){
  const g = {};
  rows.forEach(r=>{
    let lat = toNum(r['Latitude']), lng = toNum(r['Longitude']);
    if(Number.isFinite(lat) && Number.isFinite(lng) && Math.abs(lat)>20 && Math.abs(lng)<20){
      const t=lat; lat=lng; lng=t;
    }
    if(!Number.isFinite(lat) || !Number.isFinite(lng)) return;
    const key = lat.toFixed(5)+','+lng.toFixed(5);
    (g[key] ||= {lat,lng,items:[]}).items.push(r);
  });
  return g;
}
function renderMap(rows){
  ensureMap();
  LAYER.clearLayers();
  const groups = groupByLocation(rows);
  const keys = Object.keys(groups);
  const bounds = [];
  if(!keys.length){ qs('#tip').classList.remove('d-none'); return; }
  qs('#tip').classList.add('d-none');
  keys.forEach(k=>{
    const g = groups[k];
    const icon = L.divIcon({ html:"<div class='badge-pin'>"+g.items.length+"</div>", className:"", iconSize:[36,36], iconAnchor:[18,18] });
    const m = L.marker([g.lat,g.lng], {icon}).addTo(LAYER);
    const list = g.items.slice(0,12).map(i=>"• "+norm(i['Nama Ormas'])+" | "+norm(i['Lingkup'])).join("<br>");
    const more = g.items.length>12 ? "<br><em>+"+(g.items.length-12)+" lainnya…</em>" : "";
    m.bindPopup("<strong>"+g.lat.toFixed(6)+", "+g.lng.toFixed(6)+"</strong><br>Total: <b>"+g.items.length+
      "</b><hr>"+list+more);
    bounds.push([g.lat,g.lng]);
  });
  if(bounds.length) MAP.fitBounds(L.latLngBounds(bounds), {padding:[20,20]});
  setTimeout(()=>MAP.invalidateSize(), 50);
}

/* ========= APPLY FILTERS (NO JUMP) ========= */
function applyFilters(){
  const pos = lockScrollPos();
  const subset = getSubset();
  qs('#mapSection').classList.remove('d-none');
  qs('#tableSection').classList.remove('d-none');
  renderMap(subset);
  drawTable(subset);
  restoreScrollPos(pos);
}

/* ========= EVENTS ========= */
document.addEventListener('click', e=>{
  const btn = e.target.closest('.filter-badge'); if(!btn) return;
  e.preventDefault();
  qsa('.filter-badge').forEach(b=>b.classList.toggle('active', b===btn));
  state.mode = btn.dataset.mode || 'all';
  applyFilters();
}, {passive:false});

qs('#desaSelect').addEventListener('change', (e)=>{
  state.desa = e.target.value.trim();
  applyFilters();
});

qs('#reset').addEventListener('click', ()=>{
  const pos = lockScrollPos();
  qsa('.filter-badge').forEach(b=>b.classList.remove('active'));
  qs('#desaSelect').value = '';
  state.mode='all'; state.desa='';
  qs('#mapSection').classList.add('d-none');
  qs('#tableSection').classList.add('d-none');
  if(DT) DT.clear().draw(false);
  restoreScrollPos(pos);
});

/* ========= BOOT ========= */
(function boot(){
  try{
    ALL = parseCSV(RAW_CSV, ';');
    updateBadges();
    fillDesaDropdown();
  }catch(err){
    const div = document.createElement('div');
    div.className = 'alert alert-danger';
    div.innerHTML = 'Gagal memuat data tertanam: '+ (err.message||err);
    document.querySelector('.container').prepend(div);
  }
})();
</script>
</body>
</html>
